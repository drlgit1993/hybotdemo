#include "ublox_cfg.h"

#define UBLOX_SYNC1              (0xB5)
#define UBLOX_SYNC2              (0x62)
#define UBLOX_CFG_CLASS          (0x06)
#define UBLOX_CFG_ID             (0x01)
#define UBLOX_CFG_LEN_H          (0x08)
#define UBLOX_CFG_LEN_L          (0x00)
#define MESSAGE_ON               (0x01)
#define MESSAGE_OFF              (0x00)
#define UBLOX_MESSAGE_LEN     (19)

typedef enum
{
   UBLOX_MESSAGE_ID_GGA =0x00,
			UBLOX_MESSAGE_ID_GLL =0x01,
			UBLOX_MESSAGE_ID_GSA =0x02,
			UBLOX_MESSAGE_ID_GSV =0x03,
			UBLOX_MESSAGE_ID_RMC =0x04,
			UBLOX_MESSAGE_ID_VTG =0x05,
			UBLOX_MESSAGE_ID_GRS =0x06,
			UBLOX_MESSAGE_ID_GST =0x07,
			UBLOX_MESSAGE_ID_ZDA =0x08,
			UBLOX_MESSAGE_ID_GBS =0x09,
			UBLOX_MESSAGE_ID_DTM =0x0A,
			UBLOX_MESSAGE_ID_GNS =0x0D,
			UBLOX_MESSAGE_ID_THS =0x0E,
			UBLOX_MESSAGE_ID_VLM =0x0F,
			UBLOX_MESSAGE_ID_GPQ =0x40,
			UBLOX_MESSAGE_ID_TXT =0x41,
			UBLOX_MESSAGE_ID_GNQ =0x42,
			UBLOX_MESSAGE_ID_GLQ =0x43,
			UBLOX_MESSAGE_ID_GBQ =0x44
}UBLOX_MESSAGE_ID;

 
static uint8_t ublox_message_cfg[UBLOX_MESSAGE_LEN][16]=
{
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GGA,0x00,MESSAGE_ON, 0x00,0x00,0x00,0x00},/*GGA*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GLL,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GLL*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GSA,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GSA*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GSV,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GSV*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_RMC,0x00,MESSAGE_ON, 0x00,0x00,0x00,0x00},/*RMC*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_VTG,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*VTG*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GRS,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GRS*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GST,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GST*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_ZDA,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*ZDA*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GBS,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GBS*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_DTM,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*DTM*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GNS,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GNS*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_THS,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*THS*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_VLM,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*VLM*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GPQ,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GPQ*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_TXT,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*TXT*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GNQ,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GNQ*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GLQ,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00},/*GLQ*/
{UBLOX_SYNC1,UBLOX_SYNC2,UBLOX_CFG_CLASS,UBLOX_CFG_ID,UBLOX_CFG_LEN_H,UBLOX_CFG_LEN_L,0xF0,UBLOX_MESSAGE_ID_GBQ,0x00,MESSAGE_OFF,0x00,0x00,0x00,0x00} /*GBQ*/
};

void ublox_checksum(uint8_t *buff, uint8_t len)
{
			uint32_t ck_a=0,ck_b = 0,i=0;
			for (i = 2; i < len-2;i++)
			{
				ck_a += buff[i];
				ck_b += ck_a;
			}
			buff[len - 2] = (uint8_t)ck_a ;
			buff[len - 1] = (uint8_t)ck_b ;
}

void ublox_init_cfg(void)
{
   uint16_t delay=100,i=0;
			for(i=0;i<UBLOX_MESSAGE_LEN;i++)
			{
       HAL_Delay(delay);
						 ublox_checksum(ublox_message_cfg[i],16);
       USART1_data_send(ublox_message_cfg[i],16);
			}
   HAL_Delay(2000);
}
